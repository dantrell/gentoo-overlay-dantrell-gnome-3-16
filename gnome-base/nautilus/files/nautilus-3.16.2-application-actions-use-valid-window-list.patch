From dfaad5ea3de9c55922ecd369c81a861efddb349b Mon Sep 17 00:00:00 2001
From: Carlos Soriano <csoriano@gnome.org>
Date: Tue, 6 Oct 2015 15:40:52 +0200
Subject: application-actions: use valid window list

We were using the internal list of the application to
iterate through the windows and closing them.
Problem is that when closing one window, the list is modified,
so next time accessing the list we are accessing the "old"
list, which is invalid and makes nautilus crash.

To fix it make a copy of the list to preserve the consistency.

https://bugzilla.gnome.org/show_bug.cgi?id=755803
---
 src/nautilus-application-actions.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/nautilus-application-actions.c b/src/nautilus-application-actions.c
index 3caa09e..40896c4 100644
--- a/src/nautilus-application-actions.c
+++ b/src/nautilus-application-actions.c
@@ -166,9 +166,14 @@ action_quit (GSimpleAction *action,
 
 	/* nautilus_window_close() doesn't do anything for desktop windows */
 	windows = nautilus_application_get_windows (application);
+        /* make a copy, since the original list will be modified when destroying
+         * a window, making this list invalid */
+        windows = g_list_copy (windows);
 	for (l = windows; l != NULL; l = l->next) {
 		nautilus_window_close (l->data);
 	}
+
+        g_list_free (windows);
 }
 
 static void
-- 
cgit v0.11.2

